<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ title }}</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    /* height: 100%; */
    height: 100vh;
    width: 100vw;
    overflow: hidden; /* ✨ SIN SCROLL */
}

.slide-wrapper {
    height: 100vh;
    width: 100vw;
    /* width: 100%;
    height: 100%; */
    display: flex;
    flex-direction: column;
    background: #ffffff;
    overflow: hidden;
}

.slide-content {
    flex: 1;  /* ocupa todo */
    padding: 40px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box; /**/
}

.slide-inner {
    /* width: 100%;
    max-width: 1000px;
    height: auto; */

    max-width: 1000px;
    max-height: calc(100vh - 120px); /* navbar + padding */
    overflow: hidden;
}

.navbar {
    height: 60px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f0f0f0;
    padding: 10px 20px;
    box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
}

.nav-btn {
    padding: 10px 18px;
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.nav-btn:disabled {
    opacity: 0.5;
    cursor: default;
}

img { max-width: 100%; height: auto; }
</style>

<!-- css original del doc -->
{% if extra_css %}
        {{ extra_css | safe }}
{% endif %}
</head>

<body>
<div class="slide-wrapper">

    <div class="slide-content">
        <div class="slide-inner">
            {{ content | safe }}
        </div>
    </div>

    <!-- NAV BAR -->
    <div class="navbar">
        <button class="nav-btn" id="btnPrev" {% if not prev %} disabled {% endif %}>Anterior</button>
        <button class="nav-btn" id="btnNext" {% if not next %} disabled {% endif %}>Siguiente</button>
    </div>

</div>

<script>
    const NEXT_PAGE = "{{ next | default('') }}";
    const PREV_PAGE = "{{ prev | default('') }}";
    const NEXT_SCO  = "{{ next_sco | default('') }}";

    document.addEventListener("DOMContentLoaded", () => {
        const container = document.querySelector(".slide-inner");
        const rawHTML = container.innerHTML;

        const temp = document.createElement("div");
        temp.innerHTML = rawHTML;

        let slides = [];
        let currentSlide = document.createElement("div");

        container.style.visibility = "hidden"; // ocultar mientras calculamos

        const MAX_HEIGHT = container.clientHeight;

        [...temp.children].forEach(elem => {
            currentSlide.appendChild(elem.cloneNode(true));

            container.innerHTML = "";
            container.appendChild(currentSlide);

            if (container.scrollHeight > MAX_HEIGHT) {
                // quitar el último elemento que causó overflow
                currentSlide.removeChild(currentSlide.lastElementChild);

                slides.push(currentSlide);

                // crear nueva slide
                currentSlide = document.createElement("div");
                currentSlide.appendChild(elem.cloneNode(true));
            }
        });

        // agregar última slide
        slides.push(currentSlide);

        // estado
        let index = 0;

        function renderSlide() {
            container.innerHTML = slides[index].innerHTML;
        }

        renderSlide();
        container.style.visibility = "visible";

        // === BOTONES ===
        const btnPrev = document.getElementById("btnPrev");
        const btnNext = document.getElementById("btnNext");

        btnPrev.onclick = () => {
            if (index > 0) {
                index--;
                renderSlide();
            } else if ("{{ prev }}") {
                // ir al SCO anterior
                window.location.href = "{{ prev }}";
            }
        };

        btnNext.onclick = () => {
            if (index < slides.length - 1) {
                index++;
                renderSlide();
            } else if ("{{ next }}") {
                // ir al siguiente SCO
                window.location.href = "{{ next }}";
            } else {
                // finalizar SCO
                try {
                    const API = window.API || window.parent.API;
                    API.LMSSetValue("cmi.core.lesson_status", "completed");
                    API.LMSCommit("");
                } catch(e) {}
                alert("Fin del módulo");
            }
        };
    });
</script>

<!-- js original del doc -->
{% if extra_js %}
        {{ extra_js | safe }}
{% endif %}

</body>
</html>
